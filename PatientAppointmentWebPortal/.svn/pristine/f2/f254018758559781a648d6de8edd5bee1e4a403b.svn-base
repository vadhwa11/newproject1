<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
 <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/jquery.min.js"></script>
                    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/jquery.common.js"></script>
                    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/common.js"></script>
                    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/ajax.js"></script>
           
<meta charset="ISO-8859-1">
<title>Appointment History</title>
</head>
<body>
<h1>Appointment History</h1>
  From Date: <input type="date" name="fromDate" id="fromDate">
  To Date: <input type="date" name="toDate" id="toDate">
   <input type="hidden" id="serviceNo" name="serviceNo" value="${serviceNo}" >
  <button class="btn btn-info" id="searhAppointment" type="button"  onclick="searchAppointment()">Search</button>
  <br><br>
   <div id="tblEmpAndDetails"  style="display:none" class="right_col" role="main" style="padding: 0.5%  1.8%;">
    <table class="table table-striped table-bordered  ">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th id="th1">Patient Name</th>
                                                                                    <th id="th2">Relation</th>
                                                                                    <th id="th3">Age</th>
                                                                                    <th id="th4">Gender</th>
                                                                                    <th id="th5">Department Name</th>
                                                                                   
                                                                                    <th id="th6">Doctor Name</th>
                                                                                    <th id="th7">Token Number</th>
                                                                                    <th id="th8">Visit Date</th>
                                                                                    <th id="th9">Status</th>
                                                                                    <th id="th10">Action</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody id="tblListOfAppointments">
                                                                            </tbody>
                                                                        </table>
                                                                        </div>
 
 
<script>
$j(document).ready(function(){
		 var dictionary = ${appointmentList};
		 if(dictionary.status==1){
		 var visitDate; 
   		  var htmlTable = "";
   		    var data = dictionary.count;
   		    var dataList = dictionary.data;
   		   
   				 for(item in dataList){
   					visitDate= new Date(dataList[item].visitDate ).toLocaleDateString("en-US");	
   					  // htmlTable += '<tr id="'+dataList[item].Id+'" onclick="hello('+dataList+')">';
   					  htmlTable = htmlTable + "<tr id='" + dataList[item].Id + "'>";
   					  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].patientName + "</td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].relation + "</td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].age + "</td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].gender + "</td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].departmentName + "</td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].tokenNo + "</td>";
     			    	
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + visitDate + "</td>";
   			    	  if(dataList[item].visitStatus=="w"){
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Confirm </td>";
   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>"
   			    	  htmlTable= htmlTable + "<button id ='printBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='printToken("+dataList[item].visitId+");'>Print</button>";
   			    	  htmlTable= htmlTable + "<button id ='rescheduleBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='appointmentReschedule(\""+dataList[item].visitId+"\",\""+dataList[item].serviceNo+"\",\""+dataList[item].patientName+"\",\""+dataList[item].relation+"\",\""+dataList[item].dateOfBirth+"\",\""+dataList[item].gender+"\",\""+dataList[item].hospitalName+"\",\""+dataList[item].hospitalId+"\",\""+dataList[item].departmentName+"\",\""+dataList[item].departmentId+"\",\""+dataList[item].appointmentType+"\",\""+dataList[item].appointmentTypeId+"\");'>Reschedule</button>";
   			    	  htmlTable= htmlTable + "<button id ='cancelBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='cancelAppointment("+dataList[item].visitId+");'>Cancel</button></td>";
   			    	  }else if(dataList[item].visitStatus=="n"){
   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Cancelled</td>";
   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
   	   			    	 
   			    	  }else if(dataList[item].visitStatus=="c"){
    	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Completed</td>";
    	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
    	   	   			   
   			    	  }
   			    	htmlTable = htmlTable + "</tr>";
   			      }
   			      $j("#tblListOfAppointments").html(htmlTable);
   				  $j('#tblEmpAndDetails').show();
   			}else{
   				 $j('#message').html(jsonData.msg);
   				 $j('#tblEmpAndDetails').empty();
   				 $j("#tblListOfAppointments").empty();
   				 /* $j(document).ready(function(){
   		             $j('#message').fadeOut(5000);
   		             }); */
   		        
   			}
      
    
		 
	
});



function cancelAppointment(visitId) {
	/* if(document.getElementById('fromDate').value == "" || document.getElementById('fromDate') == null){
		 alert("Please enter fromDate Date.");
		 return false;
	 }
	if(document.getElementById('toDate').value == "" || document.getElementById('toDate') == null){
		 alert("Please enter toDate Date.");
		 return false;
	 } (/''"+dataList[item].visitId+"'/',/''"+dataList[item].serviceNo+"'/',/''"+dataList[item].patientName+"'/',/''"+dataList[item].relation+"'/',/''"+dataList[item].dateOfBirth+"'/',/''"+dataList[item].gender+"'/',/''"+dataList[item].hospitalName+"'/',/''"+dataList[item].hospitalId+"'/',/''"+dataList[item].departmentName+"'/',/''"+dataList[item].departmentId"'/',/''"+dataList[item].appointmentType+"'/',/''"+dataList[item].appointmentId+"'/'
			 */
	var serviceNo=$j('#serviceNo').val();
	var visitDate;
	
	var fromDate=jQuery('#fromDate').val();
	var toDate=jQuery('#toDate').val();
	if((fromDate!="" && fromDate!=null) ||(toDate!="" && fromDate!=toDate)){
   var fromDate= new Date(fromDate);
   var fromDate= new Date(fromDate);
   var toDate= new Date(toDate);
   fromDate=(( fromDate.getDate() + '-' + (fromDate.getMonth()+1) )  + '-' +  fromDate.getFullYear());
   toDate=(( toDate.getDate() + '-' + (toDate.getMonth()+1) )  + '-' +  toDate.getFullYear());
}
		var params = {
			 'visitId':visitId,
			 'fromDate':fromDate,
			 'toDate':toDate,
			 'serviceNo':serviceNo
	 } 
	
	jQuery.ajax({
		 crossOrigin: true,
		    method: "POST",
		    header:{
		    	'Access-Control-Allow-Origin': '*'
		    	},
		    	crossDomain:true,
		    url: "searchAppointment",
		    data: JSON.stringify(params),
		    contentType: "application/json; charset=utf-8",
		    dataType: "json",
		    success: function(jsonData){
		    	 if(jsonData.status==1){
		    	   alert(jsonData.msg);
		    	 $j("#tblListOfAppointments").empty();
		    		  var htmlTable = "";
		    		    var data = jsonData.count;
		    		     var dataList = jsonData.data;
		    			 for(item in dataList){
		    		   			
		    		  visitDate= new Date(dataList[item].visitDate ).toLocaleDateString("en-US");	
	   					  // htmlTable += '<tr id="'+dataList[item].Id+'" onclick="hello('+dataList+')">';
	   					  htmlTable = htmlTable + "<tr id='name'>";
	   					  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].patientName + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].relation + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].age + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].gender + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].departmentName + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].tokenNo + "</td>";
	     			    	
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + visitDate + "</td>";
	   			    	 if(dataList[item].visitStatus=="w"){
	      			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Confirm </td>";
	      			    	  htmlTable = htmlTable + "<td style='width: 150px;'>"
	      			    	  htmlTable= htmlTable + "<button id ='printBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='printToken("+dataList[item].visitId+");'>Print</button>";
	      			    	 htmlTable= htmlTable + "<button id ='rescheduleBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='appointmentReschedule(\""+dataList[item].visitId+"\",\""+dataList[item].serviceNo+"\",\""+dataList[item].patientName+"\",\""+dataList[item].relation+"\",\""+dataList[item].dateOfBirth+"\",\""+dataList[item].gender+"\",\""+dataList[item].hospitalName+"\",\""+dataList[item].hospitalId+"\",\""+dataList[item].departmentName+"\",\""+dataList[item].departmentId+"\",\""+dataList[item].appointmentType+"\",\""+dataList[item].appointmentTypeId+"\");'>Reschedule</button>";
	       			    	  htmlTable= htmlTable + "<button id ='cancelBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='cancelAppointment("+dataList[item].visitId+");'>Cancel</button></td>";
	      			    	  }else if(dataList[item].visitStatus=="n"){
	      	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Cancelled</td>";
	      	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	      	   			    	 
	      			    	  }else if(dataList[item].visitStatus=="c"){
	       	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Completed</td>";
	       	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	       	   	   			    	 
	       	   			    	 
	      			    	  }
	   			    	htmlTable = htmlTable + "</tr>";
	   			    	 
		    			    	
		    			      }
		    			 if(dataList.length == 0)
		    				{
		    					htmlTable = htmlTable+"<tr ><td colspan='4'><h6>No Record Found</h6></td></tr>";
		    					   
		    					}			
		    				
		    			      $j("#tblListOfAppointments").html(htmlTable);
		    				  $j('#tblEmpAndDetails').show();
		    			}else{
		    				 $j('#tblEmpAndDetails').empty();
		    				 $j("#tblListOfAppointments").empty();
		    				 /* $j(document).ready(function(){
		    		             $j('#message').fadeOut(5000);
		    		             }); */
		    		        
		    			}
		       
		        
		    }
		    
		    
		});
}

function printToken(visitId) {
	
}

function appointmentReschedule(visitId,serviceNo,patientname,relation,dateOfBirth,gender,hospitalName,hospitalId,departmentName,depatmentId,appointmentType,appointmentId) {

	var visitId=visitId;
	var serviceNo=serviceNo;
	var patientname=patientname;
	var dateOfBirth=dateOfBirth;
	var gender=gender;
	var hospitalName=hospitalName;
	var departmentName=departmentName;
	var hospitalId=hospitalId;
	var depatmentId=depatmentId;
	var appointmentType=appointmentType;
	var appointmentId=appointmentId;
	var relation=relation;
	alert("visitId"+visitId+serviceNo+patientname+relation+dateOfBirth+gender+hospitalName+hospitalId+departmentName+depatmentId+appointmentType+appointmentId);
	var params = {
			
			 "visitId":visitId,
			 "serviceNo":serviceNo,
			 "patientname":patientname,
			 "dateOfBirth":dateOfBirth,
			 "gender":gender,
			 "hospitalName":hospitalName,
			 "departmentName":departmentName,
			 "hospitalId":hospitalId,
			 "depatmentId":depatmentId,
			 "appointmentType":appointmentType,
			 "appointmentId":appointmentId,
			 "relation":relation
	 } 
	
	jQuery.ajax({
		 crossOrigin: true,
		    method: "POST",
		    header:{
		    	'Access-Control-Allow-Origin': '*'
		    	},
		    	crossDomain:true,
		    url: "rescheduleAppointmentDataGet",
		    data: JSON.stringify(params),
		    contentType: "application/json; charset=utf-8",
		    dataType: "json",
		    success: function(jsonData){
		    	alert("jsonData"+jsonData);
		    	 
		    	window.location.href="rescheduleAppointment?appointmentData="+visitId+","+serviceNo+","+patientname+","+dateOfBirth+","+gender+","+hospitalName+","+departmentName+","+hospitalId+","+depatmentId+","+appointmentType+","+appointmentId+","+relation+"";
		    },
	        error : function(jsonData) {
		        alert("An error has occurred while contacting the server");
	       }
		    });

}

function searchAppointment() {
	if(document.getElementById('fromDate').value == "" || document.getElementById('fromDate') == null){
		 alert("Please enter fromDate Date.");
		 return false;
	 }
	if(document.getElementById('toDate').value == "" || document.getElementById('toDate') == null){
		 alert("Please enter toDate Date.");
		 return false;
	 }
	var serviceNo=$j('#serviceNo').val();
	var visitDate;
	alert(serviceNo);
	var params = {
			 
			 'fromDate':jQuery('#fromDate').val(),
			 'toDate':jQuery('#toDate').val(),
			 'serviceNo':serviceNo
	 } 
	
	jQuery.ajax({
		 crossOrigin: true,
		    method: "POST",
		    header:{
		    	'Access-Control-Allow-Origin': '*'
		    	},
		    	crossDomain:true,
		    url: "searchAppointment",
		    data: JSON.stringify(params),
		    contentType: "application/json; charset=utf-8",
		    dataType: "json",
		    success: function(jsonData){
		      if(jsonData.status==1){
		    	 $j("#tblListOfAppointments").empty();
		    		  var htmlTable = "";
		    		    var data = jsonData.count;
		    		     var dataList = jsonData.data;
		    		     alert("datalength"+dataList);
		    		    
		    			 for(item in dataList){
		    		   			
		    		  visitDate= new Date(dataList[item].visitDate ).toLocaleDateString("en-US");	
		    			  // htmlTable += '<tr id="'+dataList[item].Id+'" onclick="hello('+dataList+')">';
	   					  htmlTable = htmlTable + "<tr id='name'>";
	   					  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].patientName + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].relation + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].age + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].gender + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].departmentName + "</td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + dataList[item].tokenNo + "</td>";
	     			    	
	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'>" + visitDate + "</td>";
	   			    	 if(dataList[item].visitStatus=="w"){
	      			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Confirm </td>";
	      			    	  htmlTable = htmlTable + "<td style='width: 150px;'>"
	      			    	  htmlTable= htmlTable + "<button id ='printBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='printToken("+dataList[item].visitId+");'>Print</button>";
	      			    	  htmlTable= htmlTable + "<button id ='rescheduleBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='appointmentReschedule(\""+dataList[item].visitId+"\",\""+dataList[item].serviceNo+"\",\""+dataList[item].patientName+"\",\""+dataList[item].relation+"\",\""+dataList[item].dateOfBirth+"\",\""+dataList[item].gender+"\",\""+dataList[item].hospitalName+"\",\""+dataList[item].hospitalId+"\",\""+dataList[item].departmentName+"\",\""+dataList[item].departmentId+"\",\""+dataList[item].appointmentType+"\",\""+dataList[item].appointmentTypeId+"\");'>Reschedule</button>";
	       			    	  htmlTable= htmlTable + "<button id ='cancelBtn' type='button'  class='btn btn-primary btn-rounded w-md waves-effect waves-light' onclick='cancelAppointment("+dataList[item].visitId+");'>Cancel</button></td>";
	      			    	  }else if(dataList[item].visitStatus=="n"){
	      	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Cancelled</td>";
	      	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	      	   			    	 
	      			    	  }else if(dataList[item].visitStatus=="c"){
	       	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'> Completed</td>";
	       	   	   			    	  htmlTable = htmlTable + "<td style='width: 150px;'></td>";
	       	   	   			    	 
	       	   			    	  }
	      			    	
	   			    	htmlTable = htmlTable + "</tr>";
	   			    	 
		    			    	
		    			      }
		    			 if(jsonData.count==0)
		    				{
		    					htmlTable = htmlTable+"<tr ><td colspan='4'><h6>No Record Found</h6></td></tr>";
		    					   
		    					}	
		    			      $j("#tblListOfAppointments").html(htmlTable);
		    				  $j('#tblEmpAndDetails').show();
		    			}else{
		    				 $j('#tblEmpAndDetails').empty();
		    				 $j("#tblListOfAppointments").empty();
		    				 /* $j(document).ready(function(){
		    		             $j('#message').fadeOut(5000);
		    		             }); */
		    		        
		    			}
		       
		        
		    }
		    
		    
		});
}
</script>
	</body>
</html>